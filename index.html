<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏£‡πâ‡∏≤‡∏á Prompt ‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ Expert Edition (V.3.25)</title>
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Google Fonts (Prompt & Sarabun) -->
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;600&family=Sarabun:wght@400;600&display=swap" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        /* Responsive adjustments */
        html, body { overflow-x: hidden; }
        body {
            font-family: 'Prompt', sans-serif;
            background: linear-gradient(135deg, #fdfbfb 0%, #ebedee 100%);
            min-height: 100vh;
            padding: 20px 0;
        }
        .container { max-width: 100%; padding-left: 15px; padding-right: 15px; }
        @media (min-width: 992px) { .container { max-width: 960px; } }
        
        .main-card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            border: 1px solid rgba(0,0,0,0.05);
            overflow: hidden;
            margin-bottom: 20px;
        }
        .card-header-custom {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-bottom: none;
        }
        .form-label { font-weight: 600; color: #2d3436; font-size: 0.95rem; }
        .section-title {
            color: #764ba2;
            font-weight: 700;
            margin-top: 25px;
            margin-bottom: 15px;
            border-left: 4px solid #764ba2;
            padding-left: 10px;
            font-size: 1.1rem;
        }
        .text-danger {
            color: #dc3545 !important;
        }
        .btn-generate {
            background: linear-gradient(45deg, #FF8008, #FFC837);
            border: none;
            color: white;
            font-weight: 600;
            padding: 12px 20px;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(255, 128, 8, 0.3);
        }
        .btn-generate:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(255, 128, 8, 0.4);
            color: white;
        }
        .btn-materials {
            background: linear-gradient(45deg, #11998e, #38ef7d);
            border: none;
            color: white;
            font-weight: 600;
            padding: 12px 20px;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(56, 239, 125, 0.3);
        }
        .btn-materials:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(56, 239, 125, 0.4);
            color: white;
        }
        .output-area {
            background-color: #f8f9fa;
            border: 2px dashed #a29bfe;
            border-radius: 10px;
            padding: 15px;
            font-family: 'Sarabun', sans-serif;
            font-size: 0.95rem;
            color: #333;
            min-height: 250px;
            white-space: pre-wrap;
            line-height: 1.6;
        }
        .output-area-materials {
            background-color: #f0fff4; /* Light green tint */
            border: 2px dashed #38ef7d;
            border-radius: 10px;
            padding: 15px;
            font-family: 'Sarabun', sans-serif;
            font-size: 0.95rem;
            color: #333;
            min-height: 200px;
            white-space: pre-wrap;
            line-height: 1.6;
        }
        
        /* Nav Pills (Top Mode) */
        .nav-pills.top-mode {
            background: rgba(255,255,255,0.2);
            border-radius: 50px;
            padding: 4px;
            display: inline-flex;
            flex-wrap: wrap;
            justify-content: center;
        }
        .nav-pills.top-mode .nav-link.active {
            background-color: #fff;
            color: #764ba2;
            font-weight: bold;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .nav-pills.top-mode .nav-link {
            color: rgba(255,255,255,0.9);
            font-weight: 500;
            border-radius: 50px;
            padding: 6px 15px;
            font-size: 0.9rem;
        }

        /* Material Tabs */
        .nav-tabs .nav-link {
            color: #495057;
            font-weight: 600;
        }
        .nav-tabs .nav-link.active {
            color: #11998e;
            border-bottom: 3px solid #11998e;
        }
        
        /* Highlight Box */
        .highlight-box {
            background-color: #f0f4ff;
            border: 1px solid #dbeafe;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }

        /* Expert Team Section Styles */
        .expert-box {
            background: linear-gradient(to right, #ffffff, #fdfbfb);
            border: 1px solid #e1e1e1;
            border-left: 4px solid #FF8008; /* Orange accent */
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            display: none; /* Hidden by default */
        }
        .expert-toggle-wrapper {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background-color: #fff3e0; /* Light Orange */
            padding: 10px 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            cursor: pointer;
            border: 1px solid #ffe0b2;
            transition: all 0.2s;
        }
        .expert-toggle-wrapper:hover {
            background-color: #ffe0b2;
        }
        .expert-check-label {
            cursor: pointer;
            user-select: none;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
        }
        .expert-check-label i {
            width: 20px;
            color: #667eea;
            margin-right: 5px;
        }
        
        .lang-switch .btn-check:checked + .btn {
            background-color: #764ba2; color: white; border-color: #764ba2;
        }
        .lang-switch .btn { border-color: #764ba2; color: #764ba2; }

        @media (max-width: 576px) {
            .card-header-custom { padding: 15px; }
            h3 { font-size: 1.25rem; }
            .section-title { margin-top: 20px; }
        }
    </style>
</head>
<body>

<div class="container">
    <div class="row justify-content-center">
        <div class="col-12">
            <div class="card main-card">
                <div class="card-header-custom">
                    <div class="row align-items-center">
                        <div class="col-md-6 text-center text-md-start mb-2 mb-md-0">
                            <h3 class="mb-1"><i class="fas fa-user-graduate me-2"></i>‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ô AI Expert</h3>
                            <small class="op-8">Lesson Plan Prompt Generator V.3.25 (Expert Edition Plus)</small>
                        </div>
                        <div class="col-md-6 text-center text-md-end">
                            <div class="nav nav-pills top-mode" id="pills-tab" role="tablist">
                                <button class="nav-link active mx-1" id="pills-std-tab" data-bs-toggle="pill" data-bs-target="#pills-std" type="button" role="tab" onclick="setMode('standard')">
                                    ‡πÅ‡∏ö‡∏ö‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô
                                </button>
                                <button class="nav-link mx-1" id="pills-rasi-tab" data-bs-toggle="pill" data-bs-target="#pills-rasi" type="button" role="tab" onclick="setMode('rasisalai')">
                                    ‡πÅ‡∏ö‡∏ö ‡∏£.‡∏£.‡∏£‡∏≤‡∏©‡∏µ‡πÑ‡∏®‡∏•
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="card-body p-3 p-md-4">
                    <form id="promptForm">
                        
                        <!-- 1. ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÅ‡∏•‡∏∞‡∏†‡∏≤‡∏©‡∏≤ -->
                        <div class="highlight-box">
                            <div class="row align-items-center mb-3">
                                <div class="col-md-6">
                                    <h5 class="text-primary mb-2 mb-md-0"><i class="fas fa-layer-group me-2"></i>‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö</h5>
                                </div>
                                <div class="col-md-6 text-md-end">
                                    <label class="form-label me-2 mb-0 text-muted" style="font-size: 0.85rem;"><i class="fas fa-language me-1"></i>‡∏†‡∏≤‡∏©‡∏≤ Prompt:</label>
                                    <div class="btn-group lang-switch" role="group">
                                        <input type="radio" class="btn-check" name="promptLang" id="langTH" value="th" checked>
                                        <label class="btn btn-sm btn-outline-primary" for="langTH">‡πÑ‡∏ó‡∏¢</label>
                                        
                                        <input type="radio" class="btn-check" name="promptLang" id="langEN" value="en">
                                        <label class="btn btn-sm btn-outline-primary" for="langEN">English</label>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Virtual Team Toggle -->
                            <div class="expert-toggle-wrapper" onclick="toggleExpertMode()">
                                <div class="d-flex align-items-center">
                                    <div class="form-check form-switch me-2 pointer-events-none">
                                        <input class="form-check-input" type="checkbox" id="expertModeToggle">
                                    </div>
                                    <span class="fw-bold text-dark"><i class="fas fa-users-cog me-2"></i>‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡πÇ‡∏´‡∏°‡∏î‡∏ó‡∏µ‡∏°‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏≤‡∏ç (Virtual Expert Team)</span>
                                </div>
                                <i class="fas fa-chevron-down" id="expertToggleIcon"></i>
                            </div>

                            <!-- Virtual Team Configuration (Hidden by default) -->
                            <div id="expertConfigBox" class="expert-box">
                                <p class="small text-muted mb-2">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡∏°‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏≤‡∏ç‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏°‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ô‡∏Å‡∏±‡∏ö‡∏Ñ‡∏∏‡∏ì:</p>
                                <div class="row g-2">
                                    <div class="col-6 col-md-4">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="roleCurriculum" checked disabled>
                                            <label class="form-check-label expert-check-label" for="roleCurriculum">
                                                <i class="fas fa-book"></i> ‡∏ô‡∏±‡∏Å‡∏´‡∏•‡∏±‡∏Å‡∏™‡∏π‡∏ï‡∏£
                                            </label>
                                        </div>
                                    </div>
                                    <div class="col-6 col-md-4">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="rolePsychologist" checked>
                                            <label class="form-check-label expert-check-label" for="rolePsychologist">
                                                <i class="fas fa-brain"></i> ‡∏à‡∏¥‡∏ï‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡πÄ‡∏î‡πá‡∏Å
                                            </label>
                                        </div>
                                    </div>
                                    <div class="col-6 col-md-4">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="roleEdTech" checked>
                                            <label class="form-check-label expert-check-label" for="roleEdTech">
                                                <i class="fas fa-laptop-code"></i> ‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏≤‡∏ç AI
                                            </label>
                                        </div>
                                    </div>
                                    <div class="col-6 col-md-4">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="roleAssessment" checked>
                                            <label class="form-check-label expert-check-label" for="roleAssessment">
                                                <i class="fas fa-clipboard-check"></i> ‡∏ô‡∏±‡∏Å‡∏ß‡∏±‡∏î‡∏ú‡∏• (Rubric/Test)
                                            </label>
                                        </div>
                                    </div>
                                    <div class="col-6 col-md-4">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="roleMedia" checked>
                                            <label class="form-check-label expert-check-label" for="roleMedia">
                                                <i class="fas fa-pencil-ruler"></i> ‡∏ô‡∏±‡∏Å‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡∏™‡∏∑‡πà‡∏≠
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row g-3">
                                <div class="col-md-4 col-sm-12">
                                    <label for="teachingModel" class="form-label">‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ô</label>
                                    <select class="form-select border-primary" id="teachingModel" onchange="toggleOtherInput('teachingModel', 'teachingModelOther')">
                                        <option value="GPAS 5 Steps" selected>GPAS 5 Steps</option>
                                        <option value="Thinking School">Thinking School</option>
                                        <option value="5E (Simplified)">5E ‡πÅ‡∏ö‡∏ö‡∏¢‡πà‡∏≠ (‡∏ô‡∏≥-‡∏™‡∏≠‡∏ô-‡∏™‡∏£‡∏∏‡∏õ)</option>
                                        <option value="5E Inquiry-Based">5E Inquiry-Based (5 ‡∏Ç‡∏±‡πâ‡∏ô)</option>
                                        <option value="Problem-Based Learning (PBL)">PBL (‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏ê‡∏≤‡∏ô)</option>
                                        <option value="Project-Based Learning (PjBL)">PjBL (‡πÇ‡∏Ñ‡∏£‡∏á‡∏á‡∏≤‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏ê‡∏≤‡∏ô)</option>
                                        <option value="STEM Education">STEM Education</option>
                                        <option value="CIPPA Model">CIPPA Model</option>
                                        <option value="other">‡∏≠‡∏∑‡πà‡∏ô‡πÜ (‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏≠‡∏á)</option>
                                    </select>
                                    <input type="text" class="form-control mt-2 d-none border-primary" id="teachingModelOther" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ô...">
                                </div>
                                <div class="col-md-4 col-sm-12">
                                    <label for="teachingTechnique" class="form-label">‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ‡πÄ‡∏™‡∏£‡∏¥‡∏°</label>
                                    <select class="form-select border-warning" id="teachingTechnique" onchange="toggleOtherInput('teachingTechnique', 'teachingTechniqueOther')">
                                        <option value="none" selected>‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏ (Active Learning)</option>
                                        <option value="Gamification">Gamification (‡πÄ‡∏Å‡∏°)</option>
                                        <option value="Unplugged Coding">Unplugged Coding</option>
                                        <option value="Flipped Classroom">Flipped Classroom</option>
                                        <option value="Think-Pair-Share">Think-Pair-Share</option>
                                        <option value="Jigsaw">Jigsaw (‡∏à‡∏¥‡πä‡∏Å‡∏ã‡∏≠‡∏ß‡πå)</option>
                                        <option value="Role Playing">Role Playing (‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó‡∏™‡∏°‡∏°‡∏ï‡∏¥)</option>
                                        <option value="Storytelling">Storytelling (‡πÄ‡∏•‡πà‡∏≤‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á)</option>
                                        <option value="Design Thinking">Design Thinking</option>
                                        <option value="other">‡∏≠‡∏∑‡πà‡∏ô‡πÜ (‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏≠‡∏á)</option>
                                    </select>
                                    <input type="text" class="form-control mt-2 d-none border-warning" id="teachingTechniqueOther" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ‡πÄ‡∏™‡∏£‡∏¥‡∏°...">
                                </div>
                                <div class="col-md-4 col-sm-12">
                                    <label for="objectiveFormat" class="form-label text-success">‡∏à‡∏∏‡∏î‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå</label>
                                    <select class="form-select border-success" id="objectiveFormat" onchange="toggleOtherInput('objectiveFormat', 'objectiveFormatOther')">
                                        <option value="K-P-A" selected>K-P-A</option>
                                        <option value="K-S-A">K-S-A</option>
                                        <option value="K-P-A-S">K-P-A-S</option>
                                        <option value="other">‡∏≠‡∏∑‡πà‡∏ô‡πÜ (‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏≠‡∏á)</option>
                                    </select>
                                    <input type="text" class="form-control mt-2 d-none border-success" id="objectiveFormatOther" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏à‡∏∏‡∏î‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå...">
                                </div>
                            </div>
                        </div>

                        <!-- 2. ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏≤ -->
                        <div class="section-title">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏≤‡πÅ‡∏•‡∏∞‡∏ú‡∏π‡πâ‡∏™‡∏≠‡∏ô</div>
                        <div class="row g-3">
                            <div class="col-md-6 col-sm-12">
                                <label for="teacherName" class="form-label">‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏£‡∏π‡∏ú‡∏π‡πâ‡∏™‡∏≠‡∏ô <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="teacherName" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏ô‡∏≤‡∏¢‡∏ä‡∏±‡∏¢‡∏ß‡∏±‡∏í‡∏ô‡πå ..." required>
                            </div>
                            <div class="col-md-6 col-sm-12">
                                <label for="subject" class="form-label">‡∏ß‡∏¥‡∏ä‡∏≤ <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="subject" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì" required>
                            </div>
                            
                            <div class="col-md-3 col-6">
                                <label for="subjectCode" class="form-label">‡∏£‡∏´‡∏±‡∏™‡∏ß‡∏¥‡∏ä‡∏≤</label>
                                <input type="text" class="form-control" id="subjectCode" placeholder="‡∏ß21101">
                            </div>
                            <div class="col-md-3 col-6">
                                <label for="grade" class="form-label">‡∏ä‡∏±‡πâ‡∏ô</label>
                                <input type="text" class="form-control" id="grade" placeholder="‡∏°.1">
                            </div>
                            <div class="col-md-3 col-6">
                                <label for="semester" class="form-label">‡∏†‡∏≤‡∏Ñ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</label>
                                <input type="text" class="form-control" id="semester" placeholder="1">
                            </div>
                            <div class="col-md-3 col-6">
                                <label for="year" class="form-label">‡∏õ‡∏µ‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤</label>
                                <input type="text" class="form-control" id="year" placeholder="2569">
                            </div>

                            <div class="col-md-6 col-sm-12">
                                <label for="unitName" class="form-label">‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ</label>
                                <input type="text" class="form-control" id="unitName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢...">
                            </div>
                            <div class="col-md-6 col-sm-12">
                                <label for="topic" class="form-label">‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏≠‡∏ô <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="topic" placeholder="‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á..." required>
                            </div>

                            <div class="col-md-4 col-sm-12">
                                <label for="time" class="form-label">‡πÄ‡∏ß‡∏•‡∏≤</label>
                                <input type="text" class="form-control" id="time" placeholder="‡πÄ‡∏ä‡πà‡∏ô 50 ‡∏ô‡∏≤‡∏ó‡∏µ">
                            </div>
                             <div class="col-md-4 col-6">
                                <label for="credit" class="form-label">‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏Å‡∏¥‡∏ï</label>
                                <input type="text" class="form-control" id="credit" placeholder="1.0">
                            </div>
                            <div class="col-md-4 col-6">
                                <label for="teachDate" class="form-label">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≠‡∏ô</label>
                                <input type="text" class="form-control" id="teachDate" placeholder="‡∏ß/‡∏î/‡∏õ">
                            </div>
                        </div>

                        <div class="text-center mt-4">
                            <button type="button" class="btn btn-generate btn-lg w-100" onclick="generatePrompt()">
                                <i class="fas fa-wand-magic-sparkles me-2"></i> ‡∏™‡∏£‡πâ‡∏≤‡∏á Prompt ‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ô (‡∏´‡∏•‡∏±‡∏Å)
                            </button>
                        </div>
                    </form>

                    <hr class="my-4">

                    <!-- Output Section 1: Main Lesson Plan -->
                    <div class="mt-3 position-relative">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <h6 class="form-label text-muted mb-0"><i class="fas fa-code me-1"></i> ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå Prompt ‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ô (‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÑ‡∏õ‡πÉ‡∏ä‡πâ)</h6>
                            <button id="copyBtn" class="btn btn-sm btn-outline-dark" onclick="copyToClipboard('outputPrompt', 'copyBtn')">
                                <i class="far fa-copy"></i> ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å
                            </button>
                        </div>
                        <textarea class="form-control output-area" id="outputPrompt" rows="10" readonly></textarea>
                    </div>

                    <!-- Output Section 2: Materials Generator (New with Tabs) -->
                    <div class="mt-4 pt-3 border-top">
                        <div class="row mb-3">
                            <div class="col-md-12 mb-2">
                                <h5 class="text-success mb-1"><i class="fas fa-file-alt me-2"></i>‡∏™‡∏£‡πâ‡∏≤‡∏á Prompt ‡πÉ‡∏ö‡∏á‡∏≤‡∏ô & ‡πÉ‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ (‡πÄ‡∏™‡∏£‡∏¥‡∏°)</h5>
                                <small class="text-muted">‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ô‡πÅ‡∏¢‡∏Å‡∏ï‡πà‡∏≤‡∏á‡∏´‡∏≤‡∏Å ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÑ‡∏î‡πâ‡∏ï‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£</small>
                            </div>
                            
                            <!-- Visual Style Selection -->
                            <div class="col-md-6 mb-3">
                                <label class="form-label text-muted small fw-bold"><i class="fas fa-paint-brush me-1"></i> ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏Å‡∏£‡∏≤‡∏ü‡∏¥‡∏Å (Visual Style):</label>
                                <div class="d-flex flex-wrap gap-3">
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="visualStyle" id="styleCartoon" value="cartoon" checked>
                                        <label class="form-check-label" for="styleCartoon">
                                            <i class="fas fa-shapes text-info me-1"></i> ‡∏Å‡∏≤‡∏£‡πå‡∏ï‡∏π‡∏ô‡∏ô‡πà‡∏≤‡∏£‡∏±‡∏Å (Cartoon)
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="visualStyle" id="styleColoring" value="coloring">
                                        <label class="form-check-label" for="styleColoring">
                                            <i class="fas fa-palette text-secondary me-1"></i> ‡∏†‡∏≤‡∏û‡∏£‡∏∞‡∏ö‡∏≤‡∏¢‡∏™‡∏µ (Coloring)
                                        </label>
                                    </div>
                                </div>
                            </div>

                            <!-- Output Type Selection (NEW) -->
                            <div class="col-md-6 mb-3">
                                <label class="form-label text-muted small fw-bold"><i class="fas fa-output me-1"></i> ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå (Output Type):</label>
                                <div class="d-flex flex-wrap gap-3">
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="outputType" id="outputTypeContent" value="content" checked>
                                        <label class="form-check-label" for="outputTypeContent">
                                            <i class="fas fa-file-alt text-success me-1"></i> üìù ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤ (Text)
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="outputType" id="outputTypeImage" value="image">
                                        <label class="form-check-label" for="outputTypeImage">
                                            <i class="fas fa-image text-danger me-1"></i> üé® ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û (Image Gen)
                                        </label>
                                    </div>
                                </div>
                            </div>

                            <div class="col-md-12 text-md-end mt-2">
                                <button type="button" class="btn btn-materials w-100" onclick="generateMaterialsPrompt()">
                                    <i class="fas fa-print me-2"></i> ‡∏™‡∏£‡πâ‡∏≤‡∏á Prompt ‡∏™‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ô
                                </button>
                            </div>
                        </div>
                        
                        <!-- Tabs Navigation -->
                        <ul class="nav nav-tabs mb-3" id="materialTabs" role="tablist">
                            <li class="nav-item" role="presentation">
                                <button class="nav-link active" id="tab-know" data-bs-toggle="tab" data-bs-target="#content-know" type="button" role="tab"><i class="fas fa-book-open me-1"></i> ‡πÉ‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ</button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="tab-work" data-bs-toggle="tab" data-bs-target="#content-work" type="button" role="tab"><i class="fas fa-pencil-alt me-1"></i> ‡πÉ‡∏ö‡∏á‡∏≤‡∏ô</button>
                            </li>
                        </ul>

                        <!-- Tabs Content -->
                        <div class="tab-content" id="materialTabsContent">
                            <!-- Knowledge Sheet Tab -->
                            <div class="tab-pane fade show active" id="content-know" role="tabpanel">
                                <div class="position-relative">
                                    <div class="d-flex justify-content-between align-items-center mb-2">
                                        <h6 class="form-label text-muted mb-0">‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå: ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÉ‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ</h6>
                                        <button id="copyKnowBtn" class="btn btn-sm btn-outline-success" onclick="copyToClipboard('outputMaterialsKnow', 'copyKnowBtn')">
                                            <i class="far fa-copy"></i> ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å
                                        </button>
                                    </div>
                                    <textarea class="form-control output-area-materials" id="outputMaterialsKnow" rows="8" readonly placeholder="‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° '‡∏™‡∏£‡πâ‡∏≤‡∏á Prompt ‡∏™‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ô' ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå..."></textarea>
                                </div>
                            </div>
                            <!-- Worksheet Tab -->
                            <div class="tab-pane fade" id="content-work" role="tabpanel">
                                <div class="position-relative">
                                    <div class="d-flex justify-content-between align-items-center mb-2">
                                        <h6 class="form-label text-muted mb-0">‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå: ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÉ‡∏ö‡∏á‡∏≤‡∏ô + ‡πÄ‡∏â‡∏•‡∏¢</h6>
                                        <button id="copyWorkBtn" class="btn btn-sm btn-outline-success" onclick="copyToClipboard('outputMaterialsWork', 'copyWorkBtn')">
                                            <i class="far fa-copy"></i> ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å
                                        </button>
                                    </div>
                                    <textarea class="form-control output-area-materials" id="outputMaterialsWork" rows="8" readonly placeholder="‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° '‡∏™‡∏£‡πâ‡∏≤‡∏á Prompt ‡∏™‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ô' ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå..."></textarea>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Warning Message -->
                        <p class="text-danger small mt-2 fw-bold mb-0 text-center"><i class="fas fa-exclamation-circle me-1"></i> ** prompt ‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏© ‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡∏î‡∏µ‡∏Å‡∏ß‡πà‡∏≤ prompt ‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢ **</p>
                    </div>

                </div>
            </div>
        </div>
    </div>
</div>

<!-- Toast Container -->
<div class="toast-container position-fixed bottom-0 end-0 p-3" style="z-index: 1055;">
    <!-- Toast: Generated -->
    <div id="liveToastGen" class="toast align-items-center text-white bg-success border-0" role="alert" aria-live="assertive" aria-atomic="true">
        <div class="d-flex">
            <div class="toast-body">
                <i class="fas fa-magic me-2"></i> ‡∏™‡∏£‡πâ‡∏≤‡∏á Prompt ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß!
            </div>
            <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
        </div>
    </div>
    <!-- Toast: Copied -->
    <div id="liveToastCopy" class="toast align-items-center text-white bg-primary border-0" role="alert" aria-live="assertive" aria-atomic="true">
        <div class="d-flex">
            <div class="toast-body">
                <i class="fas fa-clipboard-check me-2"></i> ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏•‡∏á‡∏Ñ‡∏•‡∏¥‡∏õ‡∏ö‡∏≠‡∏£‡πå‡∏î‡πÅ‡∏•‡πâ‡∏ß
            </div>
            <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
        </div>
    </div>
     <!-- Toast: Error (Validation) -->
    <div id="liveToastError" class="toast align-items-center text-white bg-danger border-0" role="alert" aria-live="assertive" aria-atomic="true">
        <div class="d-flex">
            <div class="toast-body">
                <i class="fas fa-exclamation-circle me-2"></i> ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô (‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏£‡∏π, ‡∏ß‡∏¥‡∏ä‡∏≤, ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á)
            </div>
            <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
        </div>
    </div>
</div>

<script>
    let currentMode = 'standard';
    let isExpertMode = false;

    // Toast Helper
    function showToast(elementId) {
        const toastEl = document.getElementById(elementId);
        if (toastEl) {
            const toast = new bootstrap.Toast(toastEl, { delay: 3000 });
            toast.show();
        }
    }

    function setMode(mode) {
        currentMode = mode;
        const pills = {
            std: document.getElementById('pills-std-tab'),
            rasi: document.getElementById('pills-rasi-tab')
        };

        if(mode === 'rasisalai') {
            pills.rasi.classList.add('bg-white', 'text-primary', 'shadow-sm');
            pills.rasi.style.color = "#764ba2";
            pills.std.classList.remove('bg-white', 'text-primary', 'shadow-sm');
            pills.std.style.color = "rgba(255,255,255,0.9)";
        } else {
            pills.std.classList.add('bg-white', 'text-primary', 'shadow-sm');
            pills.std.style.color = "#764ba2";
            pills.rasi.classList.remove('bg-white', 'text-primary', 'shadow-sm');
            pills.rasi.style.color = "rgba(255,255,255,0.9)";
        }
    }

    function toggleExpertMode() {
        isExpertMode = !isExpertMode;
        const toggle = document.getElementById('expertModeToggle');
        const box = document.getElementById('expertConfigBox');
        const icon = document.getElementById('expertToggleIcon');
        
        toggle.checked = isExpertMode;
        
        if (isExpertMode) {
            box.style.display = 'block';
            icon.classList.remove('fa-chevron-down');
            icon.classList.add('fa-chevron-up');
        } else {
            box.style.display = 'none';
            icon.classList.remove('fa-chevron-up');
            icon.classList.add('fa-chevron-down');
        }
    }
    
    // Allow clicking the checkbox directly without triggering the parent div's onclick twice
    document.getElementById('expertModeToggle').addEventListener('click', function(e) {
        e.stopPropagation();
        toggleExpertMode();
    });

    // --- Custom Other Input Logic ---
    function toggleOtherInput(selectId, inputId) {
        const select = document.getElementById(selectId);
        const input = document.getElementById(inputId);
        if (select.value === 'other') {
            input.classList.remove('d-none');
            input.focus();
        } else {
            input.classList.add('d-none');
        }
    }

    // Helper to get value from select or custom input
    function getSelectOrOther(selectId, inputId) {
        const selectVal = document.getElementById(selectId).value;
        if (selectVal === 'other') {
             return document.getElementById(inputId).value || '';
        }
        return selectVal;
    }

    function getFormValues() {
        const getVal = (id) => document.getElementById(id).value;
        return {
            teacher: getVal('teacherName'),
            subject: getVal('subject'),
            topic: getVal('topic'),
            subjectCode: getVal('subjectCode') || '[‡∏£‡∏´‡∏±‡∏™‡∏ß‡∏¥‡∏ä‡∏≤]',
            grade: getVal('grade') || '[‡∏ä‡∏±‡πâ‡∏ô‡∏õ‡∏µ]',
            semester: getVal('semester') || '[‡∏†‡∏≤‡∏Ñ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô]',
            year: getVal('year') || '[‡∏õ‡∏µ‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤]',
            unitName: getVal('unitName') || 'Unit 1',
            time: getVal('time') || '[‡πÄ‡∏ß‡∏•‡∏≤]',
            credit: getVal('credit') || '-',
            teachDate: getVal('teachDate') || '-',
            lang: document.querySelector('input[name="promptLang"]:checked').value,
            model: getSelectOrOther('teachingModel', 'teachingModelOther'),
            technique: getSelectOrOther('teachingTechnique', 'teachingTechniqueOther'),
            objectiveFormat: getSelectOrOther('objectiveFormat', 'objectiveFormatOther')
        };
    }

    function generatePrompt() {
        const v = getFormValues();
        
        // Validation
        if (!v.teacher || !v.subject || !v.topic) {
            showToast('liveToastError');
            return;
        }
        
        let techniqueStringTH = v.technique === 'none' ? '‡πÇ‡∏î‡∏¢‡πÄ‡∏ô‡πâ‡∏ô‡∏Å‡∏£‡∏∞‡∏ö‡∏ß‡∏ô‡∏Å‡∏≤‡∏£ Active Learning' : `‡∏ú‡∏™‡∏°‡∏ú‡∏™‡∏≤‡∏ô‡∏Å‡∏±‡∏ö‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ "${v.technique}"`;
        let techniqueValueEN = v.technique === 'none' ? 'Active Learning strategies' : `"${v.technique}" technique`;

        // --- Expert Team Logic ---
        let rolePromptTH = "‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠‡∏Ñ‡∏£‡∏π‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏≤‡∏ç‡∏î‡πâ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡πÅ‡∏•‡∏∞‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤ ‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏õ‡∏±‡∏ç‡∏ç‡∏≤‡∏õ‡∏£‡∏∞‡∏î‡∏¥‡∏©‡∏ê‡πå‡∏ä‡πà‡∏ß‡∏¢‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ô";
        let rolePromptEN = "Role: You are an expert teacher specializing in instructional design, educational technology, and **AI-integrated teaching**.";

        if (isExpertMode) {
            // Check active roles
            const usePsych = document.getElementById('rolePsychologist').checked;
            const useEdTech = document.getElementById('roleEdTech').checked;
            const useAssessment = document.getElementById('roleAssessment').checked;
            const useMedia = document.getElementById('roleMedia').checked;

            // Thai Expert Role Construction
            let teamMembersTH = "1. ‡∏ô‡∏±‡∏Å‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡∏´‡∏•‡∏±‡∏Å‡∏™‡∏π‡∏ï‡∏£ (Curriculum Specialist)";
            if (usePsych) teamMembersTH += ", 2. ‡∏ô‡∏±‡∏Å‡∏à‡∏¥‡∏ï‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡πÄ‡∏î‡πá‡∏Å (Child Psychologist) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏Å‡∏≤‡∏£‡∏ï‡∏≤‡∏°‡∏ß‡∏±‡∏¢";
            if (useEdTech) teamMembersTH += ", 3. ‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏≤‡∏ç‡∏î‡πâ‡∏≤‡∏ô‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ (EdTech & AI Specialist)";
            if (useAssessment) teamMembersTH += ", 4. ‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏≤‡∏ç‡∏î‡πâ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ß‡∏±‡∏î‡∏ú‡∏•‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏ú‡∏• (Assessment & Rubric Specialist) ‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î";
            if (useMedia) teamMembersTH += ", 5. ‡∏ô‡∏±‡∏Å‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡∏™‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ (Instructional Media Designer) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡πÉ‡∏ö‡∏á‡∏≤‡∏ô ‡πÉ‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ ‡πÅ‡∏•‡∏∞‡∏™‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡πà‡∏ô‡πà‡∏≤‡∏™‡∏ô‡πÉ‡∏à";

            rolePromptTH = `‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó: ‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠ "‡∏ó‡∏µ‡∏°‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ô (Virtual Design Team)" ‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏î‡πâ‡∏ß‡∏¢‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏≤‡∏ç‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ: ${teamMembersTH}. ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏Ñ‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡∏£‡∏∞‡∏î‡∏°‡∏™‡∏°‡∏≠‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏™‡∏π‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î`;

            // English Expert Role Construction
            let teamMembersEN = "1. Curriculum Specialist";
            if (usePsych) teamMembersEN += ", 2. Child Psychologist (to ensure age-appropriate activities)";
            if (useEdTech) teamMembersEN += ", 3. EdTech & AI Specialist";
            if (useAssessment) teamMembersEN += ", 4. Assessment Specialist (responsible for creating precise Rubrics and Tests)";
            if (useMedia) teamMembersEN += ", 5. Instructional Media Designer (to design engaging worksheets and knowledge sheets)";

            rolePromptEN = `Role: Act as a "**Virtual Instructional Design Team**" consisting of: ${teamMembersEN}. Your goal is to collaborate to create a high-quality lesson plan.`;
        }

        let promptText = "";

        if (currentMode === 'standard') {
            if (v.lang === 'th') {
                promptText = `${rolePromptTH}
‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô "‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ" ‡πÅ‡∏ö‡∏ö Active Learning
‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ä‡∏±‡πâ‡∏ô: [${v.grade}]
‡∏†‡∏≤‡∏Ñ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏µ‡πà : [${v.semester}] ‡∏õ‡∏µ‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤ : [${v.year}]
‡∏ß‡∏¥‡∏ä‡∏≤: [${v.subject}] ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á: [${v.topic}]
‡πÄ‡∏ß‡∏•‡∏≤: [${v.time}] ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏Å‡∏¥‡∏ï : [${v.credit} ‡∏´‡∏ô‡πà‡∏ß‡∏¢]
‡∏Ñ‡∏£‡∏π‡∏ú‡∏π‡πâ‡∏™‡∏≠‡∏ô : [${v.teacher}]

‡πÇ‡∏î‡∏¢‡πÉ‡∏´‡πâ‡∏°‡∏µ‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô‡∏ï‡∏≤‡∏°‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ:
1. ‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ/‡∏ï‡∏±‡∏ß‡∏ä‡∏µ‡πâ‡∏ß‡∏±‡∏î
2. ‡∏™‡∏≤‡∏£‡∏∞‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç
3. ‡∏à‡∏∏‡∏î‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ (${v.objectiveFormat})
4. ‡∏™‡∏≤‡∏£‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ
5. ‡∏™‡∏°‡∏£‡∏£‡∏ñ‡∏ô‡∏∞‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô
6. ‡∏Ñ‡∏∏‡∏ì‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞‡∏≠‡∏±‡∏ô‡∏û‡∏∂‡∏á‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå
7. ‡∏†‡∏≤‡∏£‡∏∞‡∏ä‡∏¥‡πâ‡∏ô‡∏á‡∏≤‡∏ô/‡∏ä‡∏¥‡πâ‡∏ô‡∏á‡∏≤‡∏ô (‡∏£‡∏∞‡∏ö‡∏∏‡∏á‡∏≤‡∏ô‡πÄ‡∏î‡∏µ‡πà‡∏¢‡∏ß‡πÅ‡∏•‡∏∞‡∏á‡∏≤‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏°)
8. ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ
9. ‡∏™‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ/‡πÅ‡∏´‡∏•‡πà‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ
10. ‡∏Å‡∏≤‡∏£‡∏ß‡∏±‡∏î‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏ú‡∏• (‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á Rubric ‡πÉ‡∏´‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô ‡∏á‡∏≤‡∏ô‡πÄ‡∏î‡∏µ‡πà‡∏¢‡∏ß 10 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô ‡πÅ‡∏•‡∏∞‡∏á‡∏≤‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏° 20 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô)

‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏Ç‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° (‡∏Ç‡πâ‡∏≠ 8):
1. ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ô‡πÅ‡∏ö‡∏ö "${v.model}" ${techniqueStringTH} ‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏Å‡∏ô‡∏´‡∏•‡∏±‡∏Å‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°
2. ‡∏£‡∏∞‡∏ö‡∏∏‡πÉ‡∏´‡πâ‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô‡∏ß‡πà‡∏≤‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏™‡∏≠‡∏î‡∏Ñ‡∏•‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ö "‡∏≠‡∏á‡∏Ñ‡πå‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö Active Learning" ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏£
3. ‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏ô‡∏≤‡∏ó‡∏µ ‡∏Å‡∏≥‡∏Å‡∏±‡∏ö‡∏ó‡πâ‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° (‡πÄ‡∏ä‡πà‡∏ô ‡∏Ç‡∏±‡πâ‡∏ô‡∏ô‡∏≥ (5 ‡∏ô‡∏≤‡∏ó‡∏µ))
4. ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏ô‡πâ‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏ô‡∏∏‡∏Å‡∏™‡∏ô‡∏≤‡∏ô ‡πÅ‡∏•‡∏∞‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏¢‡∏∏‡∏Å‡∏ï‡πå‡πÉ‡∏ä‡πâ‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ‡∏´‡∏£‡∏∑‡∏≠‡∏™‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡πà‡∏ô‡πà‡∏≤‡∏™‡∏ô‡πÉ‡∏à
5. ‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏¢‡∏∏‡∏Å‡∏ï‡πå‡πÉ‡∏ä‡πâ‡πÄ‡∏≠‡πÑ‡∏≠(‡∏õ‡∏±‡∏ç‡∏ç‡∏≤‡∏õ‡∏£‡∏∞‡∏î‡∏¥‡∏©‡∏ê‡πå)‡∏°‡∏≤‡∏ö‡∏π‡∏£‡∏ì‡∏≤‡∏Å‡∏≤‡∏£‡∏ä‡πà‡∏ß‡∏¢‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ô
6. ‡πÉ‡∏ä‡πâ‡∏™‡∏°‡∏£‡∏£‡∏ñ‡∏ô‡∏∞ 6 ‡∏î‡πâ‡∏≤‡∏ô‡∏´‡∏•‡∏±‡∏Å‡∏ï‡∏≤‡∏°‡∏´‡∏•‡∏±‡∏Å‡∏™‡∏π‡∏ï‡∏£‡∏ê‡∏≤‡∏ô‡∏™‡∏°‡∏£‡∏£‡∏ñ‡∏ô‡∏∞‡∏Ç‡∏≠‡∏á‡πÑ‡∏ó‡∏¢ (CBE)
7. ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏ö‡∏á‡∏≤‡∏ô‡πÉ‡∏ô‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏â‡∏•‡∏¢
8. ‡∏≠‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÅ‡∏•‡∏∞‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô 5 ‡∏Ç‡πâ‡∏≠‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏â‡∏•‡∏¢
9. ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö
${isExpertMode && document.getElementById('rolePsychologist').checked ? '10. (‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ó‡∏µ‡∏°‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏≤‡∏ç) ‡∏Ç‡∏≠‡πÉ‡∏´‡πâ‡∏°‡∏µ "‡∏°‡∏∏‡∏°‡∏°‡∏≠‡∏á‡∏ô‡∏±‡∏Å‡∏à‡∏¥‡∏ï‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤" ‡∏™‡∏±‡πâ‡∏ô‡πÜ ‡πÅ‡∏ó‡∏£‡∏Å‡πÉ‡∏ô‡∏ó‡πâ‡∏≤‡∏¢‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ô ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏ß‡πà‡∏≤‡∏ó‡∏≥‡πÑ‡∏°‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ô‡∏µ‡πâ‡∏ñ‡∏∂‡∏á‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ß‡∏±‡∏¢‡∏ô‡∏µ‡πâ' : ''}
- Create knowledge sheets and Worksheet with Answer Key.`;
            } else {
                promptText = `${rolePromptEN}
Task: Create an "**Active Learning Lesson Plan**" based on the following details:

**Context:**
- Grade Level: [${v.grade}]
- Semester: [${v.semester}] Academic Year: [${v.year}]
- Subject: [${v.subject}] Topic: [${v.topic}]
- Time Duration: [${v.time}] Credit: [${v.credit}]
- Instructor: [${v.teacher}]

**Instructional Design Requirements:**
1. **Model:** Use the "**${v.model}**" framework.
2. **Technique:** Enhance the lesson using **${techniqueValueEN}**.
3. **Objective Format:** Use **${v.objectiveFormat}** model.
4. **AI Integration:** You MUST integrate AI tools (like ChatGPT, Gemini, Canva, etc.) into the teaching/learning process effectively.

**IMPORTANT CONSTRAINTS:**
- **Output Language:** The entire lesson plan must be written in **Formal Thai Language (‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£)** suitable for an official government document.
- **Tone:** Professional, encouraging, and academic.

**Required Structure (Please use these Thai headers):**
1. ‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ/‡∏ï‡∏±‡∏ß‡∏ä‡∏µ‡πâ‡∏ß‡∏±‡∏î (Standards/Indicators)
2. ‡∏™‡∏≤‡∏£‡∏∞‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç (Concept)
3. ‡∏à‡∏∏‡∏î‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ (${v.objectiveFormat} Learning Objectives)
4. ‡∏™‡∏≤‡∏£‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ (Content)
5. ‡∏™‡∏°‡∏£‡∏£‡∏ñ‡∏ô‡∏∞‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô (Core Competencies - CBE 6 Aspects)
6. ‡∏Ñ‡∏∏‡∏ì‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞‡∏≠‡∏±‡∏ô‡∏û‡∏∂‡∏á‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå (Desirable Characteristics)
7. ‡∏†‡∏≤‡∏£‡∏∞‡∏ä‡∏¥‡πâ‡∏ô‡∏á‡∏≤‡∏ô/‡∏ä‡∏¥‡πâ‡∏ô‡∏á‡∏≤‡∏ô (Tasks/Assignments - Individual & Group)
8. ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ (Learning Activities - Detail the ${v.model} steps, specify Active Learning elements, and allocate time in minutes e.g. (5 mins))
9. ‡∏™‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ/‡πÅ‡∏´‡∏•‡πà‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ (Media/Resources)
10. ‡∏Å‡∏≤‡∏£‡∏ß‡∏±‡∏î‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏ú‡∏• (Evaluation - Include Rubrics for Individual 10pts / Group 20pts)

**Additional Requests:**
- Create knowledge sheets and Worksheet with Answer Key.
- Create Pre-test & Post-test (5 Questions) with Answers and Analysis.
${isExpertMode && document.getElementById('rolePsychologist').checked ? '- **Psychologist Insight:** At the end of the plan, add a brief note explaining why these activities are developmentally appropriate for this age group.' : ''}`;
            }
        } else {
            // RASISALAI MODE
            if (v.lang === 'th') {
                 promptText = `${rolePromptTH}
‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô "‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ" ‡∏ï‡∏≤‡∏°‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏Ç‡∏≠‡∏á‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏≤‡∏©‡∏µ‡πÑ‡∏®‡∏•
‡πÇ‡∏î‡∏¢‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ:
‡∏£‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏≤: [${v.subject}] ‡∏£‡∏´‡∏±‡∏™‡∏ß‡∏¥‡∏ä‡∏≤: [${v.subjectCode}]
‡∏ä‡∏±‡πâ‡∏ô: [${v.grade}]
‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏ó‡∏µ‡πà/‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢: [${v.unitName}]
‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á: [${v.topic}]
‡πÄ‡∏ß‡∏•‡∏≤: [${v.time}]
‡∏Ñ‡∏£‡∏π‡∏ú‡∏π‡πâ‡∏™‡∏≠‡∏ô: [${v.teacher}]
‡∏™‡∏≠‡∏ô‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: [${v.teachDate}]

‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á: ‡πÉ‡∏´‡πâ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡πÇ‡∏î‡∏¢‡∏°‡∏µ‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô‡∏ï‡∏≤‡∏°‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏≤‡∏©‡∏µ‡πÑ‡∏®‡∏• ‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ:

1. ‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ/‡∏ï‡∏±‡∏ß‡∏ä‡∏µ‡πâ‡∏ß‡∏±‡∏î
   1.1 ‡∏ï‡∏±‡∏ß‡∏ä‡∏µ‡πâ‡∏ß‡∏±‡∏î‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏ó‡∏≤‡∏á (‡∏£‡∏∞‡∏ö‡∏∏‡πÉ‡∏´‡πâ‡∏™‡∏≠‡∏î‡∏Ñ‡∏•‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ö‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤)
   1.2 ‡∏ï‡∏±‡∏ß‡∏ä‡∏µ‡πâ‡∏ß‡∏±‡∏î‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á (‡∏£‡∏∞‡∏ö‡∏∏‡πÉ‡∏´‡πâ‡∏™‡∏≠‡∏î‡∏Ñ‡∏•‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ö‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤)

2. ‡∏™‡∏≤‡∏£‡∏∞‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç (‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô Concept ‡∏´‡∏•‡∏±‡∏Å‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á)

3. ‡∏à‡∏∏‡∏î‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ (‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÅ‡∏¢‡∏Å‡πÄ‡∏õ‡πá‡∏ô ${v.objectiveFormat} ‡∏´‡∏£‡∏∑‡∏≠‡∏ï‡∏≤‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°)

4. ‡∏™‡∏≤‡∏£‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ (‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏´‡∏•‡∏±‡∏Å)

5. ‡∏Ñ‡∏∏‡∏ì‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞‡∏≠‡∏±‡∏ô‡∏û‡∏∂‡∏á‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå (‡∏£‡∏∞‡∏ö‡∏∏‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà‡∏™‡∏≠‡∏î‡∏Ñ‡∏•‡πâ‡∏≠‡∏á)

6. ‡∏™‡∏°‡∏£‡∏£‡∏ñ‡∏ô‡∏∞‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô (‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÉ‡∏´‡πâ‡∏™‡∏≠‡∏î‡∏Ñ‡∏•‡πâ‡∏≠‡∏á‡∏à‡∏≤‡∏Å 6 ‡∏î‡πâ‡∏≤‡∏ô‡∏´‡∏•‡∏±‡∏Å: 1.‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ï‡∏ô‡πÄ‡∏≠‡∏á, 2.‡∏Å‡∏≤‡∏£‡∏Ñ‡∏¥‡∏î‡∏Ç‡∏±‡πâ‡∏ô‡∏™‡∏π‡∏á, 3.‡∏Å‡∏≤‡∏£‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£, 4.‡∏Å‡∏≤‡∏£‡∏£‡∏ß‡∏°‡∏û‡∏•‡∏±‡∏á‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏ó‡∏µ‡∏°, 5.‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡πá‡∏ô‡∏û‡∏•‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏°‡πÅ‡∏Ç‡πá‡∏á, 6.‡∏Å‡∏≤‡∏£‡∏≠‡∏¢‡∏π‡πà‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏±‡∏ö‡∏ò‡∏£‡∏£‡∏°‡∏ä‡∏≤‡∏ï‡∏¥‡πÅ‡∏•‡∏∞‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏Å‡∏≤‡∏£‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏¢‡∏±‡πà‡∏á‡∏¢‡∏∑‡∏ô)

7. ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ:
   - ‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ‡∏Å‡∏£‡∏∞‡∏ö‡∏ß‡∏ô‡∏Å‡∏≤‡∏£ "${v.model}" ${techniqueStringTH}
   - ‡∏£‡∏∞‡∏ö‡∏∏‡∏≠‡∏á‡∏Ñ‡πå‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö **Active Learning** ‡πÉ‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡πÉ‡∏´‡πâ‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô
   - ‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏ô‡∏≤‡∏ó‡∏µ ‡∏Å‡∏≥‡∏Å‡∏±‡∏ö‡∏ó‡πâ‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô (‡πÄ‡∏ä‡πà‡∏ô (10 ‡∏ô‡∏≤‡∏ó‡∏µ))
   - ‡πÄ‡∏ô‡πâ‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏ô‡∏∏‡∏Å‡∏™‡∏ô‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ/AI ‡∏ä‡πà‡∏ß‡∏¢‡∏™‡∏≠‡∏ô

8. ‡∏Å‡∏≤‡∏£‡∏ß‡∏±‡∏î‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏ú‡∏•:
   ‡πÉ‡∏´‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á 4 ‡∏ä‡πà‡∏≠‡∏á ‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ:
   - ‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏µ‡πà 1: ‡∏à‡∏∏‡∏î‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ
   - ‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏µ‡πà 2: ‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏ß‡∏±‡∏î
   - ‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏µ‡πà 3: ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠
   - ‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏µ‡πà 4: ‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏Å‡∏≤‡∏£‡∏ú‡πà‡∏≤‡∏ô

9. ‡∏™‡∏∑‡πà‡∏≠/‡πÅ‡∏´‡∏•‡πà‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ

‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°:
- ‡∏Ç‡∏≠‡πÉ‡∏ö‡∏á‡∏≤‡∏ô‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏â‡∏•‡∏¢
- ‡∏Ç‡∏≠‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡πà‡∏≠‡∏ô-‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô 5 ‡∏Ç‡πâ‡∏≠ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏â‡∏•‡∏¢‡πÅ‡∏•‡∏∞‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö
- ‡∏Ç‡∏≠‡πÄ‡∏Å‡∏ì‡∏ë‡πå Rubric ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏ä‡∏¥‡πâ‡∏ô‡∏á‡∏≤‡∏ô
- Create knowledge sheets and Worksheet with Answer Key.`;
            } else {
                promptText = `${rolePromptEN}
Task: Create a "**Lesson Plan**" strictly following the **Rasisalai School Format**.

**Basic Information:**
- Subject: [${v.subject}] Code: [${v.subjectCode}]
- Class: [${v.grade}]
- Unit: [${v.unitName}] Topic: [${v.topic}]
- Time: [${v.time}]
- Teacher: [${v.teacher}]
- Date: [${v.teachDate}]

**Instructional Design Requirements:**
1. **Model:** Use "**${v.model}**" as the core framework.
2. **Technique:** Integrate **${techniqueValueEN}**.
3. **AI:** Incorporate AI tools to assist learning where appropriate.

**IMPORTANT CONSTRAINTS:**
- **Output Language:** The entire lesson plan must be written in **Formal Thai (‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£)**.
- **Format:** You must strictly follow the section numbering below.

**Required Structure (Use these Thai headers):**
1. ‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ/‡∏ï‡∏±‡∏ß‡∏ä‡∏µ‡πâ‡∏ß‡∏±‡∏î (Standards/Indicators)
   1.1 ‡∏ï‡∏±‡∏ß‡∏ä‡∏µ‡πâ‡∏ß‡∏±‡∏î‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏ó‡∏≤‡∏á (Formative Indicators)
   1.2 ‡∏ï‡∏±‡∏ß‡∏ä‡∏µ‡πâ‡∏ß‡∏±‡∏î‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á (Summative Indicators)
2. ‡∏™‡∏≤‡∏£‡∏∞‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç (Key Concept)
3. ‡∏à‡∏∏‡∏î‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ (Learning Objectives ${v.objectiveFormat})
4. ‡∏™‡∏≤‡∏£‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ (Content)
5. ‡∏Ñ‡∏∏‡∏ì‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞‡∏≠‡∏±‡∏ô‡∏û‡∏∂‡∏á‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå (Desirable Characteristics)
6. ‡∏™‡∏°‡∏£‡∏£‡∏ñ‡∏ô‡∏∞‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô (Core Competencies - Select relevant ones from the 6 Thai CBE aspects)
7. ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ (Learning Activities):
   - Design steps using **${v.model}**.
   - Explicitly mention **Active Learning** elements in each step.
   - Allocate specific time in minutes for each step (e.g. (10 mins)).
   - Integrate fun and technology/AI.
8. ‡∏Å‡∏≤‡∏£‡∏ß‡∏±‡∏î‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏ú‡∏• (Measurement & Evaluation):
   - Create a 4-column table: [‡∏à‡∏∏‡∏î‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ, ‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏ß‡∏±‡∏î, ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠, ‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏Å‡∏≤‡∏£‡∏ú‡πà‡∏≤‡∏ô]
9. ‡∏™‡∏∑‡πà‡∏≠/‡πÅ‡∏´‡∏•‡πà‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ (Media/Resources)

**Additional Requests:**
- Create knowledge sheets and Worksheet with Answer Key.
- Pre-test & Post-test (5 Questions) with Answers and Analysis.
- Rubrics for evaluation.`;
            }
        }

        document.getElementById('outputPrompt').value = promptText;
        showToast('liveToastGen');
    }

    // --- Generate Materials Prompt (Tabbed Logic) ---
    function generateMaterialsPrompt() {
        const v = getFormValues();
        if (!v.teacher || !v.subject || !v.topic) {
            showToast('liveToastError');
            return;
        }

        // --- Role Logic (Toggled by Expert Mode) ---
        // Default (Non-Expert)
        let rolePromptTH = "Role: ‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠ '‡∏ô‡∏±‡∏Å‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡∏™‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ (Instructional Media Designer)' ‡∏°‡∏∑‡∏≠‡∏≠‡∏≤‡∏ä‡∏µ‡∏û";
        let rolePromptEN = "Role: You are an expert **Instructional Media Designer**.";

        if (isExpertMode) {
            // Check active roles and build dynamic role
            let expertRolesTH = [];
            let expertRolesEN = [];

            if (document.getElementById('roleCurriculum').checked) {
                expertRolesTH.push("‡∏ô‡∏±‡∏Å‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡∏´‡∏•‡∏±‡∏Å‡∏™‡∏π‡∏ï‡∏£");
                expertRolesEN.push("Curriculum Designer");
            }
            if (document.getElementById('rolePsychologist').checked) {
                expertRolesTH.push("‡∏ô‡∏±‡∏Å‡∏à‡∏¥‡∏ï‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡πÄ‡∏î‡πá‡∏Å");
                expertRolesEN.push("Child Psychologist");
            }
            if (document.getElementById('roleEdTech').checked) {
                expertRolesTH.push("‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏≤‡∏ç‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ");
                expertRolesEN.push("EdTech Specialist");
            }
            if (document.getElementById('roleAssessment').checked) {
                expertRolesTH.push("‡∏ô‡∏±‡∏Å‡∏ß‡∏±‡∏î‡∏ú‡∏•");
                expertRolesEN.push("Assessment Specialist");
            }
            if (document.getElementById('roleMedia').checked) {
                expertRolesTH.push("‡∏ô‡∏±‡∏Å‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡∏™‡∏∑‡πà‡∏≠");
                expertRolesEN.push("Instructional Media Designer");
            }
            
            // Thai Role String
            let rolesStrTH = expertRolesTH.length > 0 ? expertRolesTH.join(", ") : "‡∏ó‡∏µ‡∏°‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏≤‡∏ç‡∏î‡πâ‡∏≤‡∏ô‡∏™‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ";
            rolePromptTH = `‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó: ‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠ "‡∏ó‡∏µ‡∏°‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡∏™‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏°‡∏∑‡∏≠‡∏≠‡∏≤‡∏ä‡∏µ‡∏û (Virtual Media Design Team)" ‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏î‡πâ‡∏ß‡∏¢: ${rolesStrTH} ‡πÇ‡∏î‡∏¢‡∏°‡∏µ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î`;

            // English Role String
            let rolesStrEN = expertRolesEN.length > 0 ? expertRolesEN.join(", ") : "Instructional Design Specialists";
            rolePromptEN = `Role: You are a "**Virtual Media Design Team**" consisting of: ${rolesStrEN}. Your goal is to collaborate to create high-quality educational materials.`;
        }

        const styleType = document.querySelector('input[name="visualStyle"]:checked').value;
        const outputType = document.querySelector('input[name="outputType"]:checked').value;

        // --- Style Description ---
        let styleDescTH = "";
        let styleDescEN = "";
        
        if (styleType === 'coloring') {
            styleDescTH = "‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏†‡∏≤‡∏û‡∏•‡∏≤‡∏¢‡πÄ‡∏™‡πâ‡∏ô‡∏Ç‡∏≤‡∏ß‡∏î‡∏≥‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏∞‡∏ö‡∏≤‡∏¢‡∏™‡∏µ (Coloring Page Style - Black & White outlines)";
            styleDescEN = "Coloring page style (Black & White outlines)";
        } else {
            styleDescTH = "‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏Å‡∏≤‡∏£‡πå‡∏ï‡∏π‡∏ô‡∏•‡∏≤‡∏¢‡πÄ‡∏™‡πâ‡∏ô‡∏™‡∏∞‡∏≠‡∏≤‡∏î‡∏ï‡∏≤‡πÅ‡∏•‡∏∞‡∏ô‡πà‡∏≤‡∏£‡∏±‡∏Å (Cartoon illustration style with clean lines)";
            styleDescEN = "Cartoon illustration style with clean lines";
        }

        // --- Content Blocks (Default Text Mode) ---
        // 1. Knowledge Sheet Block
        let knowledgeSheetTH = `1. **‡πÉ‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ (Knowledge Sheet):**
   - ‡∏™‡∏£‡∏∏‡∏õ‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç (Key Concepts) ‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á "${v.topic}"
   - ‡πÉ‡∏ä‡πâ‡∏†‡∏≤‡∏©‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏á‡πà‡∏≤‡∏¢ ‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏¢‡∏Å‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô
   - ‡∏à‡∏±‡∏î‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÉ‡∏´‡πâ‡∏ô‡πà‡∏≤‡∏≠‡πà‡∏≤‡∏ô (‡πÄ‡∏ä‡πà‡∏ô ‡∏°‡∏µ‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏´‡∏•‡∏±‡∏Å ‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏£‡∏≠‡∏á bullet points)
   - ‡πÅ‡∏ó‡∏£‡∏Å‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏ß‡πà‡∏≤‡∏Ñ‡∏ß‡∏£‡∏°‡∏µ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏ï‡∏£‡∏á‡πÑ‡∏´‡∏ô‡∏ö‡πâ‡∏≤‡∏á (‡πÄ‡∏ä‡πà‡∏ô [‡πÉ‡∏™‡πà‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏ß‡∏á‡∏à‡∏£‡πÑ‡∏ü‡∏ü‡πâ‡∏≤‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ - ${styleDescTH}])
   4. **‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï‡∏ú‡∏π‡πâ‡∏™‡∏≠‡∏ô (Footer Credit):** ‡πÉ‡∏´‡πâ‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏ó‡∏≥ "${v.teacher}" ‡πÑ‡∏ß‡πâ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡πâ‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡πÉ‡∏ö‡∏á‡∏≤‡∏ô/‡πÉ‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ`;

        let knowledgeSheetEN = `1. **Knowledge Sheet:**
   - Summarize key concepts of "${v.topic}".
   - Use age-appropriate language and clear examples.
   - Organize with clear headings, subheadings, and bullet points.
   - Suggest visual placements (e.g., [Insert diagram of photosynthesis here - ${styleDescEN}]).
   4. **Footer Credit:** Include credit line "Created by ${v.teacher}" at the bottom.`;

        // 2. Worksheet Block
        let worksheetSectionTH = `2. **‡πÉ‡∏ö‡∏á‡∏≤‡∏ô (Worksheet):**
   - ‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏´‡∏£‡∏∑‡∏≠‡πÅ‡∏ö‡∏ö‡∏ù‡∏∂‡∏Å‡∏´‡∏±‡∏î‡∏ó‡∏µ‡πà‡∏™‡∏≠‡∏î‡∏Ñ‡∏•‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ö‡πÉ‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ
   - ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏†‡∏≤‡∏û‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö: ${styleDescTH}
   - ‡∏°‡∏µ‡∏Ñ‡∏≥‡∏ä‡∏µ‡πâ‡πÅ‡∏à‡∏á (Instructions) ‡∏ó‡∏µ‡πà‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô
   - ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏´‡∏•‡∏≤‡∏Å‡∏´‡∏•‡∏≤‡∏¢ (‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏ï‡∏¥‡∏°‡∏Ñ‡∏≥, ‡∏à‡∏±‡∏ö‡∏Ñ‡∏π‡πà, ‡∏õ‡∏£‡∏ô‡∏±‡∏¢, ‡∏´‡∏£‡∏∑‡∏≠‡∏≠‡∏±‡∏ï‡∏ô‡∏±‡∏¢) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡πâ‡∏≤‡∏ó‡∏≤‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î
   - ‡πÄ‡∏ô‡πâ‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡∏¥‡∏î‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡πÑ‡∏õ‡πÉ‡∏ä‡πâ
   - ‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï‡∏ó‡πâ‡∏≤‡∏¢‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©: "${v.teacher}"`;

        let worksheetSectionEN = `2. **Worksheet:**
   - Create engaging activities/exercises aligned with the knowledge sheet.
   - Illustration Style: ${styleDescEN}
   - Include clear instructions.
   - Use mixed question types (Fill-in-the-blank, Matching, Critical thinking questions).
   - Add footer credit: "${v.teacher}"`;

        // 3. Answer Key Block (Only for Text Mode)
        let answerKeyTH = `3. **‡πÄ‡∏â‡∏•‡∏¢‡πÉ‡∏ö‡∏á‡∏≤‡∏ô (Answer Key):** ‡∏£‡∏∞‡∏ö‡∏∏‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î`;
        let answerKeyEN = `3. **Answer Key:** Provide accurate and detailed answers.`;

        // Expert Mode Visual Overrides (Text Mode Only)
        if (isExpertMode && outputType === 'content') {
            // Dynamic Role in Content Content is already set in rolePrompt
            worksheetSectionTH = `2. **‡πÉ‡∏ö‡∏á‡∏≤‡∏ô (‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏ä‡∏¥‡∏á‡∏Å‡∏£‡∏≤‡∏ü‡∏¥‡∏Å‡πÅ‡∏ö‡∏ö‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î):**
   ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏ö‡∏á‡∏≤‡∏ô‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏µ‡πà‡∏û‡∏¥‡∏°‡∏û‡πå‡πÑ‡∏î‡πâ (Printable) ‡∏ö‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á A4 ‡πÅ‡∏ô‡∏ß‡∏ï‡∏±‡πâ‡∏á **${styleDescTH}** ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ä‡∏±‡πâ‡∏ô ${v.grade}
   
   **[‡∏™‡πà‡∏ß‡∏ô‡∏´‡∏±‡∏ß (Header)]**
   * ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á: '${v.topic}', ‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏¢‡πà‡∏≠‡∏¢: '${v.unitName}'
   
   **[‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏ß‡∏≤‡∏á: ‡∏ö‡∏ô & ‡∏•‡πà‡∏≤‡∏á]**
   * **‡∏™‡πà‡∏ß‡∏ô‡∏ö‡∏ô (Top Section - ‡∏™‡∏µ‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠: ‡∏™‡∏µ‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ô‡πÑ‡∏î‡πâ‡∏Å‡∏±‡∏ö‡∏ò‡∏µ‡∏° '${v.topic}'):**
       * ‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠: ‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏¢‡πà‡∏≠‡∏¢‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ö '${v.topic}'
       * **[‡∏á‡∏≤‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏£‡∏£‡∏Ñ‡πå]** ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° (‡πÄ‡∏ä‡πà‡∏ô ‡∏à‡∏±‡∏ö‡∏Ñ‡∏π‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏á, ‡πÄ‡∏ï‡∏¥‡∏°‡∏Ñ‡∏≥‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á) ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö '${v.topic}'
   * **‡∏™‡πà‡∏ß‡∏ô‡∏•‡πà‡∏≤‡∏á (Bottom Section - ‡∏™‡∏µ‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠: ‡∏™‡∏µ‡∏Ñ‡∏π‡πà‡∏ï‡∏£‡∏á‡∏Ç‡πâ‡∏≤‡∏°‡∏ó‡∏µ‡πà‡πÇ‡∏î‡∏î‡πÄ‡∏î‡πà‡∏ô):**
       * ‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠: ‡∏≠‡∏µ‡∏Å‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏¢‡πà‡∏≠‡∏¢‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ö '${v.topic}'
       * **[‡∏á‡∏≤‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏£‡∏£‡∏Ñ‡πå]** ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° (‡πÄ‡∏ä‡πà‡∏ô ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏õ‡∏•‡∏≤‡∏¢‡πÄ‡∏õ‡∏¥‡∏î, ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ß‡∏≤‡∏î‡∏†‡∏≤‡∏û) ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö '${v.topic}'
   
   **[‡∏™‡πà‡∏ß‡∏ô‡∏ó‡πâ‡∏≤‡∏¢ (Footer)]**
   * ‡∏™‡πà‡∏ß‡∏ô‡∏•‡πà‡∏≤‡∏á‡∏™‡∏∏‡∏î‡∏°‡∏µ‡πÄ‡∏™‡πâ‡∏ô‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô: '‡∏ä‡∏∑‡πà‡∏≠: __________', '‡∏ä‡∏±‡πâ‡∏ô: ...........', '‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà: ...' (‡πÉ‡∏ä‡πâ‡πÄ‡∏™‡πâ‡∏ô‡∏õ‡∏£‡∏∞‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ä‡πà‡∏≠‡∏á‡∏ä‡∏±‡πâ‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ô)
   * ‡πÉ‡∏™‡πà‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡πá‡∏Å‡πÜ ‡πÉ‡∏ï‡πâ‡πÄ‡∏™‡πâ‡∏ô‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î: "‡∏Ñ‡∏£‡∏π‡∏ú‡∏π‡πâ‡∏™‡∏≠‡∏ô: ${v.teacher}"
   
   **[‡∏Ç‡πâ‡∏≠‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ç‡∏≠‡∏á‡πÉ‡∏ö‡∏á‡∏≤‡∏ô (Worksheet Requirement)]**
   * ‡∏à‡∏±‡∏î‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ß‡πà‡∏≤‡∏á‡πÉ‡∏´‡πâ‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏Ç‡∏≠‡∏á‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô
   * **‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏°‡∏≤‡∏Å (CRITICAL):** ‡∏™‡∏∏‡πà‡∏°/‡∏™‡∏•‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏ô‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô
   * **‡∏Ç‡πâ‡∏≠‡∏´‡πâ‡∏≤‡∏°‡πÄ‡∏î‡πá‡∏î‡∏Ç‡∏≤‡∏î (STRICTLY PROHIBITED):** ‡∏´‡πâ‡∏≤‡∏°‡∏ß‡∏≤‡∏î‡πÄ‡∏™‡πâ‡∏ô‡πÇ‡∏¢‡∏á, ‡∏•‡∏π‡∏Å‡∏®‡∏£, ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏™‡πâ‡∏ô‡∏õ‡∏£‡∏∞‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏Ç‡πâ‡∏≠ ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ "‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏™‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏µ‡πà‡∏¢‡∏°‡∏ß‡πà‡∏≤‡∏á" ‡∏Ç‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏ï‡∏¥‡∏°‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç/‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡πÅ‡∏ó‡∏ô ‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏ï‡πâ‡∏≠‡∏á‡πÇ‡∏•‡πà‡∏á‡∏™‡∏ô‡∏¥‡∏ó ‡∏´‡πâ‡∏≤‡∏°‡πÄ‡∏â‡∏•‡∏¢‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏•‡∏á‡πÉ‡∏ô‡πÉ‡∏ö‡∏á‡∏≤‡∏ô
   
   **[‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°]** ‡πÉ‡∏ä‡πâ‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤ ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏ã‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ
   **[‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£]** Use Clean, Modern, Sans-Serif, Professional Google Fonts supporting Thai (e.g. style of "Mitr" or "Prompt"). Automatically select a font style that matches the mood of '${v.topic}' and is legible for ${v.grade} students.`;

            worksheetSectionEN = `2. **Worksheet (Visual Structure Specification):**
   A printable student activity worksheet on an A4 portrait background. **${styleDescEN}**, aimed at ${v.grade} students.
   
   **[Header]** Title: '${v.topic}', Subtitle: '${v.unitName}'.
   
   **[Layout: Top & Bottom]**
   * **Top Section (Header Color: a harmonious color selected to match '${v.topic}'):**
       * Title: A sub-topic related to '${v.topic}'.
       * **[Creative Task]** Create an activity (matching with empty answer boxes, fill-in-blanks) related to '${v.topic}'.
   * **Bottom Section (Header Color: a complementary color):**
       * Title: Another sub-topic related to '${v.topic}'.
       * **[Creative Task]** Create an activity (questions, drawing space) related to '${v.topic}'.
   
   **[Footer]**
   * Bottom section with writeable lines for: 'Name: __________', 'Class: ...........', 'No: ...'. Use dotted lines for the Class field.
   * Add a small credit line below: "Teacher: ${v.teacher}"
   
   **[Worksheet Requirement]**
   * Ensure clear areas for student interaction.
   * **CRITICAL:** Randomize/Shuffle items in columns so they are NOT aligned. Keep the activity **UNSOLVED**.
   * **STRICTLY PROHIBITED:** Do not draw any lines, arrows, dashed lines, or connectors between items. Instead, provide empty answer boxes next to items.
   * The gap between columns must be completely blank. Do NOT fill in answers.
   
   **[Text Note]** Use Thai language for content. Do NOT render complex text unnecessarily.
   **[Typography Style]** Use Clean, Modern, Sans-Serif, Professional Google Fonts supporting Thai (e.g. style of "Mitr" or "Prompt"). Automatically select a font style that matches the mood of '${v.topic}' and is legible for ${v.grade} students.`;
        }

        // --- Logic: Output Type = IMAGE GEN ---
        if (outputType === 'image') {
            // Image Mode: IF EXPERT ON, prepend the Role
            let contextHeader = "";
            if (isExpertMode) {
                if (v.lang === 'th') {
                    contextHeader = `${rolePromptTH}\nTask: ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏™‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏ï‡∏≤‡∏°‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡∏ô‡∏µ‡πâ:\n\n`;
                } else {
                    contextHeader = `${rolePromptEN}\nTask: Generate educational images based on the following prompts:\n\n`;
                }
            }
            
            // Knowledge Sheet Prompt (UPDATED V.3.17 + 3.19 Credit)
            let knowPrompt = `"A rich educational infographic knowledge sheet on an A4 portrait background. ${styleDescEN}, aimed at ${v.grade} students.

**[Header]** Title: '${v.topic}', Subtitle: '${v.unitName}'.

**[Visual Content]** Create detailed, colorful diagrams and illustrations that explain the concept of '${v.topic}'. Use clear icons, flowcharts, or characters to visually demonstrate the key ideas. The visuals should be the main focus.

**[Layout]** Arrange information logically in distinct sections.
- Top: Introduction with a central image.
- Middle: Detailed process or components with smaller icons.
- Bottom: Summary or interesting facts.

**[Style]** Engaging, informative, distinct from a worksheet. This sheet is for **reading and learning**. 

**[Footer]** Simple decorative bottom border. Include a distinct credit line in small text: "Created by ${v.teacher}". CRITICAL: Do NOT include any student input fields (No Name/Class lines).

**[Text Note]** Include headings and structure text blocks clearly. Actual text can be simulated (lorem ipsum) or simple labels, but the layout must look like a readable guide.
**[Typography Style]** Use Clean, Modern, Sans-Serif, Professional Google Fonts supporting Thai (e.g. style of "Mitr" or "Prompt"). Automatically select a font style that matches the mood of '${v.topic}' and is legible for ${v.grade} students."`;

            // Worksheet Prompt
            let workPrompt = `"A printable student activity worksheet on an A4 portrait background. ${styleDescEN}, aimed at ${v.grade} students.

**[Header]** Title: '${v.topic}', Subtitle: '${v.unitName}'.

**[Layout: Top & Bottom]**
Top Section (Header Color: a harmonious color automatically selected to match the topic '${v.topic}'): Title a sub-topic related to '${v.topic}', containing:
**[Creative Task]** Create an activity (matching with empty answer boxes, fill-in-blanks) related to '${v.topic}'.
Bottom Section (Header Color: a complementary color to the first section): Title another sub-topic related to '${v.topic}', containing:
**[Creative Task]** Create an activity (questions, drawing space) related to '${v.topic}'.

**[Footer]** Bottom section with writeable lines for: 'Name: __________', 'Class: ...........', 'No: ...'. Below that, add a small credit line: "Teacher: ${v.teacher}".

**[Worksheet Requirement]** Ensure clear areas for student interaction. CRITICAL: Randomize/Shuffle items in columns so they are NOT aligned. Keep the activity UNSOLVED.
STRICTLY PROHIBITED: Do not draw any lines, arrows, dashed lines, or connectors between items.
Instead of lines, provide empty answer boxes next to the left-column items for students to write letters/numbers. The gap between columns must be completely blank. Do NOT fill in answers.

**CRITICAL: Leave all answer areas completely blank. Do not write 'Placeholder' or any text. Use empty rectangular boxes or clear horizontal lines for writing areas. The sheet must be ready for students to write on manually.**
**[Typography Style]** Use Clean, Modern, Sans-Serif, Professional Google Fonts supporting Thai (e.g. style of "Mitr" or "Prompt"). Automatically select a font style that matches the mood of '${v.topic}' and is legible for ${v.grade} students."`;

            knowledgeSheetTH = contextHeader + knowPrompt;
            knowledgeSheetEN = contextHeader + knowPrompt;

            worksheetSectionTH = contextHeader + workPrompt;
            worksheetSectionEN = contextHeader + workPrompt;

            answerKeyTH = ""; 
            answerKeyEN = "";
        }

        // --- Construct Final Prompts ---
        let promptKnow, promptWork;

        if (v.lang === 'th') {
            let contextHeader;
            
            if (outputType === 'image') {
                promptKnow = `${knowledgeSheetTH}`;
                promptWork = `${worksheetSectionTH}`;
            } else {
                // Content Mode: Role play as Teacher/Creator with Dynamic Role
                contextHeader = `${rolePromptTH}\nTask: ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡πÉ‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡πÅ‡∏•‡∏∞‡πÉ‡∏ö‡∏á‡∏≤‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á: "${v.topic}" ‡∏ß‡∏¥‡∏ä‡∏≤: ${v.subject} ‡∏ä‡∏±‡πâ‡∏ô: ${v.grade}\n‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á: ‡πÉ‡∏´‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏•‡∏∞‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡∏Å‡∏±‡∏ö‡∏ß‡∏±‡∏¢ (Output full content ready to use)\n\n`;
                promptKnow = `${contextHeader}**‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á:**\n${knowledgeSheetTH}\n\n‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°: ‡πÄ‡∏ô‡πâ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏£‡∏∏‡∏õ‡∏ó‡∏µ‡πà‡∏Å‡∏£‡∏∞‡∏ä‡∏±‡∏ö ‡∏≠‡πà‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢ ‡πÅ‡∏•‡∏∞‡∏™‡∏ß‡∏¢‡∏á‡∏≤‡∏°`;
                promptWork = `${contextHeader}**‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á:**\n${worksheetSectionTH}\n\n${answerKeyTH}\n\n‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°: ‡πÄ‡∏ô‡πâ‡∏ô‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ó‡∏µ‡πà‡∏ó‡πâ‡∏≤‡∏ó‡∏≤‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏°‡∏∑‡∏≠‡∏ó‡∏≥`;
            }

        } else {
            let contextHeader;
            
            if (outputType === 'image') {
                promptKnow = `${knowledgeSheetEN}`;
                promptWork = `${worksheetSectionEN}`;
            } else {
                contextHeader = `${rolePromptEN}\nTask: Write the full text content for educational materials on topic: "${v.topic}".\nSubject: ${v.subject}, Grade Level: ${v.grade}.\nOutput Language: **Formal Thai** (Ready to use).\n\n`;
                promptKnow = `${contextHeader}**Requirements:**\n${knowledgeSheetEN}\n\nStyle: Clear, concise, and visually appealing summary.`;
                promptWork = `${contextHeader}**Requirements:**\n${worksheetSectionEN}\n\n${answerKeyEN}\n\nStyle: Engaging activities requiring critical thinking and hands-on practice.`;
            }
        }

        // Populate Textareas
        document.getElementById('outputMaterialsKnow').value = promptKnow;
        document.getElementById('outputMaterialsWork').value = promptWork;
        
        showToast('liveToastGen');
    }

    // ----------------------------------------------------
    // Robust Copy Function (Belt and Braces approach)
    // ----------------------------------------------------
    async function copyToClipboard(elementId, btnId) {
        const textarea = document.getElementById(elementId);
        const text = textarea.value;
        const btn = document.getElementById(btnId);
        const originalHtml = btn.innerHTML;

        if (!text) return; // Do nothing if empty

        // UI Feedback Helper
        const showSuccess = () => {
            btn.innerHTML = '<i class="fas fa-check"></i> ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢';
            btn.classList.remove(btnId.includes('copy') ? 'btn-outline-success' : 'btn-outline-dark'); // Hacky check for button style
            if(btn.classList.contains('btn-outline-dark')) btn.classList.remove('btn-outline-dark');
            
            btn.classList.add('btn-success');
            showToast('liveToastCopy'); 
            setTimeout(() => {
                btn.innerHTML = originalHtml;
                btn.classList.remove('btn-success');
                // Restore original class roughly
                if (btnId.includes('copyKnow') || btnId.includes('copyWork')) {
                     btn.classList.add('btn-outline-success');
                } else {
                     btn.classList.add('btn-outline-dark');
                }
            }, 2000);
        };

        const showError = () => {
            btn.innerHTML = '<i class="fas fa-times"></i> ‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î';
            btn.classList.add('btn-danger');
            setTimeout(() => {
                btn.innerHTML = originalHtml;
                btn.classList.remove('btn-danger');
            }, 2000);
        };

        // 1. Try Modern Async API first
        if (navigator.clipboard && navigator.clipboard.writeText) {
            try {
                await navigator.clipboard.writeText(text);
                showSuccess();
                return; 
            } catch (err) {
                console.warn('Clipboard API failed, trying fallback...', err);
            }
        }

        // 2. Fallback: document.execCommand('copy')
        try {
            textarea.select();
            textarea.setSelectionRange(0, 99999); 
            const successful = document.execCommand('copy');
            if (successful) {
                showSuccess();
            } else {
                console.error('execCommand returned false');
                showError();
                alert('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏î Ctrl+C');
            }
        } catch (err) {
            console.error('Fallback copy failed', err);
            showError();
            alert('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏î‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏î‡πâ‡∏ß‡∏¢‡∏ï‡∏ô‡πÄ‡∏≠‡∏á');
        }
    }

    // Init Standard Mode Style
    setMode('standard');
</script>

<!-- Bootstrap 5 JS Bundle -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
